{%extends 'inventory/base.html' %}

{% block title %}×¢×¨×•×š ××•×¦×¨ - {{ product.name }} - ××¢×¨×›×ª × ×™×”×•×œ ××œ××™{% endblock %}

{% block content %}
<div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-edit me-2"></i>×¢×¨×•×š ××•×¦×¨: {{ product.name }}</h4>
                    </div>
                    <div class="card-body">
                        <form method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.name.id_for_label }}" class="form-label">×©× ×”××•×¦×¨:</label>
                                        {{ form.name }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.description.id_for_label }}" class="form-label">×ª×™××•×¨:</label>
                                        {{ form.description }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.category.id_for_label }}" class="form-label">×§×˜×’×•×¨×™×”:</label>
                                        {{ form.category }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.supplier.id_for_label }}" class="form-label">×¡×¤×§:</label>
                                        {{ form.supplier }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.location.id_for_label }}" class="form-label">××™×§×•×:</label>
                                        {{ form.location }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.quantity.id_for_label }}" class="form-label">×›××•×ª:</label>
                                        {{ form.quantity }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.min_quantity.id_for_label }}" class="form-label">×›××•×ª ××™× ×™××œ×™×ª:</label>
                                        {{ form.min_quantity }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.max_quantity.id_for_label }}" class="form-label">×›××•×ª ××§×¡×™××œ×™×ª:</label>
                                        {{ form.max_quantity }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.unit.id_for_label }}" class="form-label">×™×—×™×“×”:</label>
                                        {{ form.unit }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.cost_price.id_for_label }}" class="form-label">××—×™×¨ ×¢×œ×•×ª:</label>
                                        {{ form.cost_price }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.selling_price.id_for_label }}" class="form-label">××—×™×¨ ××›×™×¨×”:</label>
                                        {{ form.selling_price }}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.barcode.id_for_label }}" class="form-label">×‘×¨×§×•×“:</label>
                                        {{ form.barcode }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.status.id_for_label }}" class="form-label">×¡×˜×˜×•×¡:</label>
                                        {{ form.status }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.weight.id_for_label }}" class="form-label">××©×§×œ (×§"×’):</label>
                                        {{ form.weight }}
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.dimensions.id_for_label }}" class="form-label">××™×“×•×ª (LxWxH):</label>
                                        {{ form.dimensions }}
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.notes.id_for_label }}" class="form-label">×”×¢×¨×•×ª:</label>
                                {{ form.notes }}
                            </div>

                            <!-- ×ª××•× ×ª ×‘×¨×§×•×“ -->
                            <div class="mb-3">
                                <label for="{{ form.barcode_image.id_for_label }}" class="form-label">×ª××•× ×ª ×‘×¨×§×•×“:</label>
                                {% if product.barcode_image %}
                                <div class="mb-2">
                                    <img src="{{ product.barcode_image.url }}" alt="×‘×¨×§×•×“ × ×•×›×—×™" class="img-thumbnail" style="max-height: 150px;">
                                    <small class="d-block text-muted mt-1">×ª××•× ×” × ×•×›×—×™×ª</small>
                                </div>
                                {% endif %}
                                {{ form.barcode_image }}
                                <small class="form-text text-muted">
                                    {% if product.barcode_image %}
                                    ×‘×—×¨ ×§×•×‘×¥ ×—×“×© ×›×“×™ ×œ×”×—×œ×™×£ ××ª ×”×ª××•× ×” ×”×§×™×™××ª
                                    {% else %}
                                    ×”×¢×œ×” ×ª××•× ×ª ×‘×¨×§×•×“ ×—×“×©×”
                                    {% endif %}
                                </small>
                            </div>

                            <!-- ×ª××•× ×ª ××•×¦×¨ -->
                            <div class="mb-3">
                                <label for="{{ form.product_image.id_for_label }}" class="form-label">×ª××•× ×ª ××•×¦×¨:</label>
                                {% if product.product_image %}
                                <div class="mb-2">
                                    <img src="{{ product.product_image.url }}" alt="×ª××•× ×ª ××•×¦×¨ × ×•×›×—×™×ª" class="img-thumbnail" style="max-height: 200px;">
                                    <small class="d-block text-muted mt-1">×ª××•× ×” × ×•×›×—×™×ª</small>
                                </div>
                                {% endif %}
                                {{ form.product_image }}
                                <small class="form-text text-muted">
                                    {% if product.product_image %}
                                    <strong>ğŸ’¡ ×‘×—×¨ ×§×•×‘×¥ ×—×“×© ×›×“×™ ×œ×”×—×œ×™×£ ××ª ×”×ª××•× ×” ×”×§×™×™××ª</strong>
                                    {% else %}
                                    ×”×¢×œ×” ×ª××•× ×ª ××•×¦×¨ ×—×“×©×”
                                    {% endif %}
                                </small>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i>×©××•×¨ ×©×™× ×•×™×™×
                                </button>
                                <a href="{% url 'product_detail' product.pk %}" class="btn btn-secondary">
                                    <i class="fas fa-times me-1"></i>×‘×™×˜×•×œ
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript ×œ×ª×¦×•×’×” ××§×“×™××” ×©×œ ×ª××•× ×•×ª -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // ×ª×¦×•×’×” ××§×“×™××” ×œ×ª××•× ×ª ××•×¦×¨
        const productImageInput = document.getElementById('{{ form.product_image.id_for_label }}');
        if (productImageInput) {
            productImageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // ×—×™×¤×•×© ×”×ª××•× ×” ×”×§×™×™××ª ××• ×™×¦×™×¨×ª ××œ×× ×˜ ×—×“×©
                        let preview = productImageInput.parentElement.querySelector('.preview-image');
                        if (!preview) {
                            preview = document.createElement('div');
                            preview.className = 'preview-image mt-2 p-2 border border-success rounded bg-light';
                            preview.innerHTML = '<strong class="text-success d-block mb-1">âœ… ×ª×¦×•×’×” ××§×“×™××” - ×ª××•× ×” ×—×“×©×”:</strong><img class="img-thumbnail" style="max-height: 200px;">';
                            productImageInput.parentElement.insertBefore(preview, productImageInput.nextSibling);
                        }
                        preview.querySelector('img').src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // ×ª×¦×•×’×” ××§×“×™××” ×œ×ª××•× ×ª ×‘×¨×§×•×“
        const barcodeImageInput = document.getElementById('{{ form.barcode_image.id_for_label }}');
        if (barcodeImageInput) {
            barcodeImageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // ×—×™×¤×•×© ×”×ª××•× ×” ×”×§×™×™××ª ××• ×™×¦×™×¨×ª ××œ×× ×˜ ×—×“×©
                        let preview = barcodeImageInput.parentElement.querySelector('.preview-image');
                        if (!preview) {
                            preview = document.createElement('div');
                            preview.className = 'preview-image mt-2 p-2 border border-success rounded bg-light';
                            preview.innerHTML = '<strong class="text-success d-block mb-1">âœ… ×ª×¦×•×’×” ××§×“×™××” - ×ª××•× ×” ×—×“×©×”:</strong><img class="img-thumbnail" style="max-height: 150px;">';
                            barcodeImageInput.parentElement.insertBefore(preview, barcodeImageInput.nextSibling);
                        }
                        preview.querySelector('img').src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // ×”×•×¡×¤×ª ××™× ×“×™×§×˜×•×¨ ×•×™×–×•××œ×™ ×œ×›×¤×ª×•×¨ ×©××™×¨×”
        const form = document.querySelector('form');
        if (form) {
            form.addEventListener('submit', function() {
                const submitBtn = form.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>×©×•××¨...';
                }
            });
        }
    });
    </script>
{% endblock %}
