# 🏪 מערכת חנות ומחסן - מדריך מהיר

## 📋 סוגי מיקומים במערכת

### 1️⃣ חנות 🏪 (ברירת מחדל)
```
✓ למכירה ללקוחות
✓ מתעדכן אוטומטית בכל מכירה
✓ נבחר אוטומטית כשפותחים מכירה חדשה
```

### 2️⃣ מחסן 🏭
```
✓ אחסון מרכזי
✓ אספקה לחנויות
✗ לא ניתן למכור ישירות מהמחסן
```

---

## 🛒 זרימת מכירה

### פתיחת מכירה חדשה → `/sales/add/`

```
┌─────────────────────────────────────┐
│  מכירה חדשה                        │
├─────────────────────────────────────┤
│  לקוח: [בחר לקוח ▼]  [+ חדש]     │
│                                     │
│  חנות: [חנות ראשית ✓]  ← אוטומטי │
│        ℹ המלאי יורד מהחנות שתבחר   │
│                                     │
│  סטטוס: [טיוטה ▼]                 │
│  תשלום: [ממתין ▼]                 │
└─────────────────────────────────────┘
```

### מה קורה ברקע?

```python
# 1. מציאת חנות ראשית
default_store = Location.objects.filter(
    location_type='store',
    is_main_store=True
).first()

# 2. בחירה אוטומטית
form = SaleForm(initial={'location': default_store.id})

# 3. הצגת חנויות בלבד
queryset = Location.objects.filter(
    location_type='store',
    is_active=True
)
```

---

## 📦 ניהול מלאי

### מבנה המלאי

```
מוצר: טלפון iPhone
├─ חנות תל אביב:  50 יחידות 🏪
├─ חנות חיפה:     30 יחידות 🏪
├─ מחסן ראשי:    200 יחידות 🏭
└─ סה"כ כללי:    280 יחידות 📊
```

### כשמבצעים מכירה

```python
# מכירה: 2 יחידות מחנות תל אביב

לפני:
חנות תל אביב:  50 יחידות
מלאי כללי:    280 יחידות

אחרי:
חנות תל אביב:  48 יחידות (-2)
מלאי כללי:    278 יחידות (-2)
מחסן ראשי:    200 יחידות (ללא שינוי)
```

---

## 🔄 העברת מלאי

### מחסן → חנות

```
העברות → העברה חדשה

מקור:  [מחסן ראשי ▼]
יעד:    [חנות תל אביב ▼]
מוצר:  [בחר מוצר ▼]
כמות:  [____]

[שמור העברה]
```

### תוצאה:
```
מחסן ראשי:     200 → 190 (-10)
חנות תל אביב:   48 →  58 (+10)
מלאי כללי:     278 → 278 (ללא שינוי)
```

---

## ⚙️ הגדרות ראשוניות

### 1. יצירת מיקומים

```
מיקומים → הוסף מיקום

שם:           חנות ראשית
סוג:          [חנות ▼]  ← ברירת מחדל
כתובת:       רחוב הרצל 1, תל אביב
חנות ראשית:  ☑ כן  ← חשוב!
פעיל:         ☑ כן
```

**💡 טיפ:** סמן חנות אחת כ"חנות ראשית" כדי שתיבחר אוטומטית בכל מכירה!

### 2. הוספת מלאי למיקום

```
מנהל → מלאי מוצרים במיקומים

מוצר:   [iPhone ▼]
מיקום:  [חנות ראשית ▼]
כמות:   [50____]

[שמור]
```

---

## 🎯 דוגמת שימוש מלאה

### תרחיש: מכירת 2 טלפונים מחנות תל אביב

```
1️⃣ מכירות → מכירה חדשה

2️⃣ לקוח:  "משה כהן" (או הוסף חדש)
   חנות:  "חנות תל אביב" ✓ (כבר נבחר)

3️⃣ הוסף מוצרים:
   • iPhone × 2 → ₪7,000

4️⃣ סיכום:
   לפני מע"מ: ₪7,000
   מע"מ (17%): ₪1,190
   סה"כ:       ₪8,190 💰

5️⃣ [שמור מכירה]

6️⃣ חשבונית נוצרה! 📄
   מספר: 202510-00001
   [הפק חשבונית מס]
```

### מה קרה ברקע?

```
✓ חשבונית נוצרה עם מספר ייחודי
✓ מלאי בחנות ת"א: 50 → 48 (-2)
✓ מלאי כללי: 280 → 278 (-2)
✓ היסטוריית לקוח עודכנה
✓ חשבונית מס מוכנה להדפסה
```

---

## 📊 דוחות ותצוגות

### דוח מלאי לפי מיקום

```
מוצר        │ חנות ת"א │ חנות חיפה │ מחסן ראשי │ סה"כ
────────────┼──────────┼───────────┼───────────┼──────
iPhone      │    48    │     30    │    200    │  278
Samsung     │    25    │     15    │    150    │  190
```

### דוח מכירות לפי חנות

```
חנות         │ מכירות היום │ השבוע
─────────────┼─────────────┼────────
חנות ת"א     │   ₪8,190   │ ₪65K
חנות חיפה    │   ₪5,400   │ ₪42K
```

---

## ❓ שאלות נפוצות

### ש: למה לא מוצג המחסן בבחירת מכירה?
**ת:** מכירות מתבצעות רק מחנויות. המחסן משמש לאחסון ואספקה בלבד.

### ש: איך מעבירים מלאי מהמחסן לחנות?
**ת:** העברות → העברה חדשה → מקור: מחסן, יעד: חנות.

### ש: מה קורה אם אין מלאי בחנות?
**ת:** המכירה תיכשל. יש להעביר מלאי מהמחסן לחנות תחילה.

### ש: איך משנים חנות ראשית?
**ת:** מיקומים → עריכת חנות → סמן "חנות ראשית" ✓

### ש: אפשר למכור ממספר חנויות באותה מכירה?
**ת:** לא. כל מכירה קשורה לחנות אחת. המלאי יורד רק מהחנות שנבחרה.

---

## 🔐 הרשאות

### קופאי
```
✓ מכירות מהחנות שלו
✓ צפייה במלאי
✗ העברות מלאי
✗ ניהול מיקומים
```

### מנהל חנות
```
✓ מכירות מהחנות
✓ העברות מלאי (בקשה ממחסן)
✓ דוחות חנות
✗ ניהול מיקומים
```

### מנהל מערכת
```
✓ כל הפעולות
✓ ניהול מיקומים
✓ הגדרת חנות ראשית
✓ כל הדוחות
```

---

## 🚀 סיכום מהיר

### ✅ מה יש במערכת:
- 🏪 **חנויות** - למכירה ללקוחות
- 🏭 **מחסנים** - לאחסון ואספקה
- 📦 **מלאי נפרד** - לכל מיקום
- 📊 **מלאי כללי** - סיכום אוטומטי
- 🔄 **העברות** - בין מיקומים
- 📄 **חשבוניות מס** - אוטומטיות
- 📷 **סריקת ברקוד** - במצלמה

### ✅ ברירות מחדל:
- מיקום חדש → **חנות**
- מכירה חדשה → **חנות ראשית**
- בחירת מיקום → **רק חנויות**

### ✅ זרימת עבודה:
```
1. מחסן ראשי (200 יחידות)
   ↓ העברה
2. חנות תל אביב (50 יחידות)
   ↓ מכירה
3. לקוח (2 יחידות)
```

---

## 📞 תמיכה

### בעיה: החנות לא מופיעה במכירה
```
✓ בדוק שהחנות מסומנת כ"פעילה"
✓ בדוק שסוג המיקום הוא "חנות" (לא מחסן)
✓ רענן את הדף
```

### בעיה: המלאי לא מתעדכן
```
✓ בדוק שבחרת חנות במכירה
✓ ודא שהמכירה נשמרה בהצלחה
✓ בדוק ב"מלאי מוצרים במיקומים"
```

---

**המערכת מוכנה לשימוש! 🎉**

**גרסה:** 2.1
**תאריך:** 04/10/2025
**עדכון:** הפרדה מלאה בין חנות למחסן

